<script>
this.Mobify || (function(detector, ajs) {

this.Mobify = {ajs: ajs, points: [+new Date], tagVersion: [7, 1]};

// Initial load and followup.
// If src=1 or array ran out of elements, don't load.
// If src=-1, total failure, set the opt out cookie.
// Otherwise just load the script, and check if it was good once it is ready.
function next() {
    src = paths.shift() || 1;
    if (Mobify.api || +src) {
        ~src || (doc.cookie = mobifypath + '=; path=/');
    } else {
        script = doc.createElement(sscript);
        script.src = src;
        script.onload = script.onerror = next;
        firstScript.parentNode.insertBefore(script, firstScript);
    }
}

var doc = document
  , src = 1
  , sscript = 'script'
  , mobify = 'mobify'
  , mobifycom = mobify + '.com/'
  , mobifypath = mobify + '-path'
  , unmobify = mobifycom + 'un' + mobify + '2.js'
  , script
  , firstScript = doc.getElementsByTagName(sscript)[0]
  , paths
  , matchedPath = /((; )|#|&|^)mobify-path=([^&;]*)/g.exec(location.hash + '; ' + doc.cookie);

// If path matched, load from preview. 
// If path was empty, don't load.
// Otherwise ask the `detector` what to load and provide `unmobify` fallbacks.
// Prioritize anchor over cookie and sessionStorage.
paths = matchedPath
    && (src = matchedPath[3])
    && !+(src = matchedPath[2] && sessionStorage[mobifypath] || src)
    && [1, '//preview.' + mobifycom + escape(src), 1];

// Allows `detector` to not return a value and still not mobify.
src = src && detector();
paths = paths || src || [0, ajs];

// Load Mobify.js using `setTimeout` to foil the lookahead parser.
// Otherwise load any provided fallback script.
if (paths.shift()) {
    paths.push('//cdn.' + unmobify, '//files01.' + unmobify, -1);

    // To support late tag injection, uncomment the following:
    // readyState: uninitialized|loading|loaded|interactive|complete
    // Loading is document.write friendly, all others will blow up the doc.
    //if (/g$/.test(doc.readyState)) {
    doc.write('<plaintext style="display:none">');
    //}   
}

setTimeout(next);

})(function() {
    if (/ip(hone|od|ad)|android|blackberry.*applewebkit/i.test(navigator.userAgent)){
        // Here, you can doc.write markup that tells user that something is happening
        // Also, you could preload important stylesheets/images/etc.
        // Make sure to use mobify-ignore class on all top level elements you end up creating,
        // so that they would not be picked up by adaptation.
        return [1, 'http://localhost:8080/mobify.js']
    }
}, "http://cloud.mobify.com/path/to/a.js");
</script>
