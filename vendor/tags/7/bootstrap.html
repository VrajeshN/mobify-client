<script>
this.Mobify || (function(detectorUrl) {

  var Mobify = this.Mobify = { points: [new Date], tagVersion: [9, 0] } // Cloud Nine
    , sScript = "script" //Repeated strings are exposed as constants to aid minification
    , sCookie = "cookie"
    , sMobifyCapture = 'mobify-capture'
    , doc = document    
    , firstScript = doc.getElementsByTagName(sScript)[0]
      , script
    , mode = doc[sCookie].match(/(; |^)mobify-capture=([^;]*)/)

    // These two variables are used by desktop() and are moved out to save minifcation expenses
    // of second var declaration
    , host = location.host
    , desktop = function() {
        // Disable mobify <plaintext> capturing on all possible subdomain matches.
        // We do that to make mobify disabling work no matter what domain the cookie was originally set on
        // Since this is done only in catastrophic circumstances, I consider resulting overdisabling tolerable
        // User will have to restart browser to clear that away

        while (!Mobify.detector && (host = host.replace(/^\.?[^.]*/, ''))) {
          doc[sCookie] = sMobifyPath + '=0; domain=.' + host + '; path=/';
        }
      };

  // The many modes of mobify-capture cookie:
  // Not set at all - we are lost and confused, and need to run detection
  // Empty - user or detector code explicitly opted out of transform, no capture
  // Number that is zero - a.js or other light adaptation, needs no capture
  // Number that is not zero - adaptation with capture required 
  // A string with zero in front - preview of light adaptation
  // A string with nonzero number in front - preview of capture-based adaptation

  // The 'no cookie at all' branch
  // Name can be used by preview to force synchronous detection and reset existing cookie state
  if (!mode || (0 == name.indexOf(sMobifyCapture))) {

    // Note that we got only one source here. Older tags used to allow failover with multiple sources.
    // However, that was false robustness, as even one script load failure can result in a very long
    // timeout delay, making page de facto broken in eyes of the user. So, removing this functionality
    // seemed worthwhile, as we can cut out sync+async chainloading code and shorten the tag.
    doc.write('<script src="' + detectorUrl + '"><\/script>');

    // If the script never loads, fix next load by opting out of mobify for duration of session
    setTimeout(desktop, 10000);
  } else {
    mode = mode[2]; // Get cookie value out of regexp match

    // parseInt will ignore URL after the initial number inside the cookie. This means that both normal
    // and preview-induced captures will go through
    if (parseInt(mode) > 0) doc.write('<plaintext style="display:none">');

    script = doc.createElement(sScript)
      script.src = detectorUrl;

      // + will result in NaN for number+URL combinations. We do want a <plaintext> during previews,
      // but probably don't want to complicate debugging by reverting to desktop when a preview URL fails
      if (+mode) { 
        script.onload = script.onerror = desktop;
    }
      firstScript.parentNode.insertBefore(script, firstScript);
  }
})("//cdn.mobify.com/generic/detector.js");
</script>
