<script>
this.Mobify || (function(detector, ajs) {

this.Mobify = {ajs: ajs, points: [new Date], tagVersion: [7, 2]};

// Pull a URL off load queue and try to load it. onload/onerror handlers will make sure that this function runs again after scripts loads or errors out, so we could keep trying sources until we run out. A successful load will set Mobify.api to version of MobifyJS API (or to 1, if version is not yet known).
// We use two special sentinel values for src
// If src=1, we behave as if our array ran out of elements and softly give up. This is used if we fail to load a supplementary file (e.g. analytics)
// If src=-1, we failed to load an adaptation or a curative unmobify2.js. This means we are in big trouble, so we would prevent content capturing on subsequent loads via a cookie.

function next() {
    src = paths.shift() || 1;
    if (Mobify.api || +src) {
        ~src || (doc.cookie = sMobifyPath + '=; path=/');
    } else {
        script = doc.createElement(sScript);
        script.src = src;
        script.onload = script.onerror = next;
        firstScript.parentNode.insertBefore(script, firstScript);
    }
}

var doc = document
  , src = 1
  , sScript = 'script'
  , sMobify = 'mobify'
  , sMobifyCom = sMobify + '.com/'
  , sMobifyPath = sMobify + '-path'
  , sUnmobify = sMobifyCom + 'un' + sMobify + '2.js'
  , script
  , firstScript = doc.getElementsByTagName(sScript)[0]
    // Paths should be of the form [<0/1>, url, url, ... ]. A url can be replaced with terminator value of 1 or -1 (described in next() comments)
  , slicer = /(; )?mobify-path=([^;]*)/
  , cookiePath = slicer.exec('; ' + doc.cookie + name) || 0

  , paths = cookiePath[1]
      && (src = cookiePath[2])
      && !+(src = (slicer.exec(name) || 0)[2] || sessionStorage[sMobifyPath] || src)
      && [1, '//preview.' + sMobifyCom + escape(src), 1];

src = src && detector();
paths = paths || src || [0, ajs];

if (paths.shift()) {
    paths.push('//cdn.' + sUnmobify, '//files01.' + sUnmobify, -1);
    doc.write('<plaintext style="display:none">');
}

setTimeout(next);

})(function() {
    if (/ip(hone|od|ad)|android|blackberry.*applewebkit/i.test(navigator.userAgent)){
        // Here, you can doc.write markup that tells user that something is happening
        // Also, you could preload important stylesheets/images/etc.
        // Make sure to use mobify-ignore class on all top level elements you end up creating,
        // so that they would not be picked up by adaptation.
        return [1, 'http://localhost:8080/mobify.js']
    }
}, "http://cloud.mobify.com/path/to/a.js");
</script>
